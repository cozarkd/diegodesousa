---
import GitHub from '@/components/icons/GitHub.astro'
import NextJS from '@/components/icons/NextJS.astro'
import Tailwind from '@/components/icons/Tailwind.astro'
import Eleventy from '@/components/icons/Eleventy.astro'
import Tauri from '@/components/icons/Tauri.astro'
import Link from '@/components/icons/Link.astro'
import LinkButton from '@/components/LinkButton.astro'

import { Image } from 'astro:assets'
import { getCollection } from 'astro:content'
import { getI18N } from '@/i18n'

const { currentLocale } = Astro
const i18n = getI18N({ currentLocale })

interface Tag {
  name: string
  class: string
  icon?: any
}

interface Project {
  title: string
  description: string
  tags: Tag[]
  link?: string
  github?: string
  image?: string
  video?: string
  isDraft: boolean
  language: string
}

const projects = await getCollection('projects')

const filteredProjects = projects
  .map((project) => project.data)
  .filter((project) => project.language === currentLocale)
---

<h2 class='text-3xl font-bold text-primary'>{i18n.PROJECTSSECTION.H2}</h2>
<div class='flex flex-col gap-y-16'>
  {
    filteredProjects
      .filter((project: Project) => !project.isDraft)
      .map((project: Project) => (
        <article class='group flex flex-col space-x-0 space-y-8 md:flex-row md:space-x-8 md:space-y-0'>
          <div class='w-full md:w-1/2'>
            <div
              class={`relative col-span-6 row-span-5 flex transform flex-col items-center gap-8 overflow-clip rounded-sm shadow-xl transition duration-500 ease-in-out sm:rounded-sm md:group-hover:-translate-y-1 md:group-hover:shadow-2xl`}
            >
              {project.video ? (
                <video
                  src={project.video}
                  autoplay
                  loop
                  muted
                  playsinline
                  poster={project.image}
                  class='w-full object-contain object-top transition duration-500'
                >
                  {project.image && (
                    <Image
                      src={project.image}
                      alt={project.title}
                      loading='lazy'
                      class='w-full object-contain object-top transition duration-500'
                    />
                  )}
                </video>
              ) : (
                project.image && (
                  <Image
                    src={project.image}
                    alt={project.title}
                    loading='lazy'
                    class='w-full object-contain object-top transition duration-500'
                  />
                )
              )}
            </div>
          </div>
          <div class='w-full md:w-1/2 md:max-w-lg'>
            <h3 class='mb-4 text-balance text-2xl font-bold text-secondary dark:text-secondary'>
              {project.title}
            </h3>
            <div class='mt-2 flex flex-wrap'>
              <ul class='mb-2 flex flex-row gap-x-2'>
                {project.tags.map((tag: Tag) => (
                  <li>
                    <span
                      class={`flex gap-x-2 rounded-full text-xs ${tag.class} px-2 py-1 `}
                    >
                      {tag.name}
                    </span>
                  </li>
                ))}
              </ul>
              <div
                class='mt-2 text-gray-700 dark:text-gray-100'
                set:html={project.description}
              />
              <footer class='mt-4 flex items-end justify-start gap-x-4'>
                {project.github && (
                  <LinkButton asChild>
                    <a href={project.github}>
                      <GitHub class='size-6' />
                      {i18n.PROJECTSSECTION.SOURCECODE}
                    </a>
                  </LinkButton>
                )}
                {project.link && (
                  <LinkButton href={project.link} asChild>
                    <Link class='size-4' />
                    {i18n.PROJECTSSECTION.LIVEDEMO}
                  </LinkButton>
                )}
              </footer>
            </div>
          </div>
        </article>
      ))
  }
</div>
