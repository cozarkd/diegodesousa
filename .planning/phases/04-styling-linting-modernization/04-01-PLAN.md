---
phase: 04-styling-linting-modernization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-lock.yaml
  - astro.config.mjs
  - tailwind.config.cjs
  - postcss.config.cjs
  - src/styles/global.css
  - plugins/tailwind/seasonalStylesPlugin.ts
  - prettier.config.cjs
autonomous: true

must_haves:
  truths:
    - "Site builds successfully with Tailwind CSS 4 via @tailwindcss/vite plugin"
    - "All 4 seasonal themes (spring, summer, autumn, winter) plus Christmas and Halloween themes apply correctly via CSS variables"
    - "Dark mode toggle switches all theme colors correctly"
    - "Custom scrollbar styles render on the main page"
    - "Background images (spring-light, spring-dark) still load"
    - "All existing utility classes render identically (shadows, borders, rings, animations)"
  artifacts:
    - path: "src/styles/global.css"
      provides: "CSS-first Tailwind 4 config with @import tailwindcss, @theme directive, seasonal CSS variables"
      contains: "@import \"tailwindcss\""
    - path: "astro.config.mjs"
      provides: "Vite plugin config replacing @astrojs/tailwind integration"
      contains: "@tailwindcss/vite"
    - path: "package.json"
      provides: "Updated dependencies: tailwindcss 4, @tailwindcss/vite, tailwind-merge 3+, tailwind-scrollbar 4"
  key_links:
    - from: "astro.config.mjs"
      to: "@tailwindcss/vite"
      via: "vite.plugins array"
      pattern: "tailwindcss.*from.*@tailwindcss/vite"
    - from: "src/styles/global.css"
      to: "tailwindcss"
      via: "@import directive"
      pattern: "@import.*tailwindcss"
    - from: "src/styles/global.css"
      to: "seasonal theme variables"
      via: "CSS custom properties in @theme and :root selectors"
      pattern: "--theme-primary|--primary"
---

<objective>
Migrate from Tailwind CSS 3 to Tailwind CSS 4 with CSS-first architecture, including the seasonal theming system, companion packages, and all utility class updates.

Purpose: Replace the deprecated @astrojs/tailwind integration and JavaScript-based config with Tailwind 4's @tailwindcss/vite plugin and CSS @theme directive. Migrate the build-time seasonal theme plugin from JS addBase() to CSS custom properties.

Output: Working Tailwind 4 setup with all seasonal themes, dark mode, scrollbar, animations, and background images functioning identically to current state.
</objective>

<execution_context>
@/Users/mini/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mini/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-styling-linting-modernization/04-RESEARCH.md

@astro.config.mjs
@tailwind.config.cjs
@src/styles/global.css
@plugins/tailwind/seasonalStylesPlugin.ts
@postcss.config.cjs
@prettier.config.cjs
@package.json
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run automated Tailwind 4 upgrade and install dependencies</name>
  <files>package.json, pnpm-lock.yaml, astro.config.mjs, tailwind.config.cjs, postcss.config.cjs, src/styles/global.css</files>
  <action>
  Run the automated Tailwind CSS upgrade tool to handle the bulk of the migration:

  1. Run `npx @tailwindcss/upgrade` from the project root. This tool will:
     - Upgrade `tailwindcss` to v4
     - Install `@tailwindcss/vite` plugin
     - Convert `@tailwind base/components/utilities` to `@import "tailwindcss"` in global.css
     - Migrate `tailwind.config.cjs` theme values into CSS `@theme` directive in global.css
     - Update utility class renames in templates (shadow-sm to shadow-xs, etc.)
     - Remove PostCSS-based Tailwind setup from postcss.config.cjs
     - Update astro.config.mjs to use @tailwindcss/vite plugin instead of @astrojs/tailwind

  2. After the automated tool runs, manually verify and fix:
     - In `astro.config.mjs`: Remove the `import tailwind from "@astrojs/tailwind"` and `tailwind()` from integrations. Remove `import tailwindcssNesting from 'tailwindcss/nesting'` and the vite.css.postcss.plugins nesting config (Tailwind 4 has native nesting). Add `import tailwindcss from '@tailwindcss/vite'` and add `tailwindcss()` to a `vite: { plugins: [...] }` section.
     - Ensure `@astrojs/tailwind` is removed from package.json dependencies.
     - Remove `tailwindcss-animate` from dependencies (it uses v3 plugin API). Replace with `tw-animate-css` which provides CSS-only animations compatible with Tailwind 4: `pnpm add -D tw-animate-css`. In global.css, add `@import "tw-animate-css";` after `@import "tailwindcss";` to preserve the `animate-in`, `fade-in`, `duration-*` utility classes used in global.css.
     - Update companion packages: `pnpm add tailwind-merge@latest tailwind-scrollbar@latest prettier-plugin-tailwindcss@latest`
     - tailwind-scrollbar v4 uses `@plugin` directive. In global.css, add `@plugin "tailwind-scrollbar";` to load it.

  3. Update `prettier.config.cjs` (or convert to `prettier.config.mjs` if the upgrade tool does):
     - Add `tailwindStylesheet: './src/styles/global.css'` option (required for Tailwind 4 class sorting)
     - Keep existing plugins: prettier-plugin-astro, prettier-plugin-tailwindcss, prettier-plugin-css-order

  4. If `postcss.config.cjs` is now empty or only has autoprefixer, it can be simplified or removed (Tailwind 4 with Vite plugin does not need PostCSS for Tailwind processing; autoprefixer is also unnecessary since Tailwind 4 handles vendor prefixes).

  5. Verify the automated migration did not break `@layer base` blocks in global.css. Tailwind 4 uses `@layer` differently. The `@layer base { * { @apply border-border; } }` and `@layer base { body { @apply bg-background ... } }` patterns should be converted. In Tailwind 4, use `@layer base { ... }` only for base style resets. The `@apply` directive still works.

  6. Run `pnpm build` to verify the build passes with Tailwind 4. Fix any errors.
  </action>
  <verify>
  - `pnpm build` completes without errors
  - `package.json` shows `tailwindcss` at v4.x, `@tailwindcss/vite` present, `@astrojs/tailwind` removed
  - `tailwind-merge` at v3.x+, `tailwind-scrollbar` at v4.x
  - `astro.config.mjs` uses `@tailwindcss/vite` in vite.plugins, no `tailwind()` in integrations
  - `src/styles/global.css` starts with `@import "tailwindcss"`, has `@theme` block
  - No `@tailwind base/components/utilities` directives remain in any CSS file
  </verify>
  <done>Tailwind CSS 4 installed via @tailwindcss/vite, automated migration applied, companion packages updated, build passes</done>
</task>

<task type="auto">
  <name>Task 2: Migrate seasonal theming system from JS plugin to CSS custom properties</name>
  <files>src/styles/global.css, plugins/tailwind/seasonalStylesPlugin.ts</files>
  <action>
  The current `plugins/tailwind/seasonalStylesPlugin.ts` uses Tailwind v3's `plugin()` API with `addBase()` to inject CSS variables at build time based on `new Date()`. The GitHub Actions cron job triggers rebuilds at season transitions, so the correct theme is always baked into the CSS.

  For Tailwind 4, the plugin API changed fundamentally. We need to migrate to CSS-first theming. There are two options for preserving build-time theme determination:

  **Approach: CSS-first with build-time script**

  1. Move ALL seasonal theme CSS variable definitions into `src/styles/global.css` as CSS selectors on `:root[data-season="..."]`. Include all 6 themes (christmas, halloween, winter, spring, summer, autumn) with both light and dark variants.

  Each theme defines these 5 CSS variables: `--primary`, `--secondary`, `--accent`, `--background`, `--foreground`. Copy the exact HSL values from `seasonalStylesPlugin.ts` for each season.

  Structure in global.css (after the `@theme` block):
  ```css
  /* Default theme (fallback to winter since current date is February) */
  :root {
    --background: 210 100% 97%;
    --foreground: 210 20% 20%;
    --primary: 210 70% 50%;
    --secondary: 0 0% 40%;
    --accent: 0 84% 48%;
  }
  .dark {
    --background: 210 20% 20%;
    --foreground: 210 100% 97%;
    --primary: 210 70% 70%;
    --secondary: 0 0% 80%;
    --accent: 0 84% 70%;
  }

  :root[data-season="christmas"] { ... }
  :root[data-season="christmas"].dark { ... }
  :root[data-season="halloween"] { ... }
  :root[data-season="halloween"].dark { ... }
  :root[data-season="winter"] { ... }
  :root[data-season="winter"].dark { ... }
  :root[data-season="spring"] { ... }
  :root[data-season="spring"].dark { ... }
  :root[data-season="summer"] { ... }
  :root[data-season="summer"].dark { ... }
  :root[data-season="autumn"] { ... }
  :root[data-season="autumn"].dark { ... }
  ```

  2. Add an inline script in the `<head>` (via `BaseHead.astro` or the layout) that determines the current season and sets `data-season` on `<html>`. This runs client-side on page load. Use the same date logic from `seasonalStylesPlugin.ts`.

  Create `src/scripts/seasonal-theme.ts` with the season detection function. Then add a `<script is:inline>` tag in the head that calls it immediately to set `document.documentElement.setAttribute('data-season', getCurrentSeason())`. This must run before first paint to avoid FOUC (flash of unstyled content). Use `is:inline` to ensure it runs immediately without module loading.

  3. The `@theme` block in global.css should reference these CSS variables for the color tokens that the rest of the site uses. The existing `hsl(var(--primary))` pattern from `tailwind.config.cjs` should be preserved in the `@theme` block:
  ```css
  @theme {
    --color-primary: hsl(var(--primary));
    --color-primary-foreground: hsl(var(--primary-foreground));
    --color-secondary: hsl(var(--secondary));
    --color-secondary-foreground: hsl(var(--secondary-foreground));
    --color-accent: hsl(var(--accent));
    --color-accent-foreground: hsl(var(--accent-foreground));
    --color-background: hsl(var(--background));
    --color-foreground: hsl(var(--foreground));
    --color-border: hsl(var(--border));
    --color-input: hsl(var(--input));
    --color-ring: hsl(var(--ring));
    --color-card: hsl(var(--card));
    --color-card-foreground: hsl(var(--card-foreground));
    --color-popover: hsl(var(--popover));
    --color-popover-foreground: hsl(var(--popover-foreground));
    --color-muted: hsl(var(--muted));
    --color-muted-foreground: hsl(var(--muted-foreground));
    --color-destructive: hsl(var(--destructive));
    --color-destructive-foreground: hsl(var(--destructive-foreground));
  }
  ```

  IMPORTANT: In Tailwind 4, the `@theme` block registers color names with `--color-*` prefix. So `--color-primary: hsl(var(--primary))` makes `bg-primary`, `text-primary` etc. work. The raw CSS variables (`--primary`, `--background`, etc.) continue to be set per-season in `:root` selectors. This two-layer approach preserves the existing `hsl(var(--...))` pattern.

  4. Preserve the existing non-seasonal CSS variables in `:root` that are NOT overridden by the seasonal plugin (card, popover, muted, destructive, border, input, ring, radius, primary-foreground, secondary-foreground, accent-foreground). These stay in their existing `:root` and `.dark` blocks.

  5. Preserve the `backgroundImage` values from `tailwind.config.cjs` in the `@theme` block:
  ```css
  @theme {
    --bg-image-spring-light: url("/images/bgs/Spring-light.png");
    --bg-image-spring-dark: url("/images/bgs/Spring-dark.png");
  }
  ```

  6. Preserve the custom `container`, `dropShadow`, `boxShadow`, `borderRadius`, `keyframes`, and `animation` values from `tailwind.config.cjs` in the `@theme` block.

  7. After migration, the old `plugins/tailwind/seasonalStylesPlugin.ts` file is no longer needed. Delete it (or keep for reference and mark as deprecated). The `tailwind.config.cjs` file should also be removable since all configuration is now in CSS (if the automated upgrade tool didn't already handle this).

  8. The GitHub Actions workflow (`update.yml`) and `update_date.sh` currently trigger a rebuild. After this migration, the seasonal theme is determined client-side via the inline script. The rebuild trigger is still useful for any build-time changes, but the theme no longer depends on build-time date evaluation. The workflow can remain as-is for now.

  9. Run `pnpm dev` and verify in browser that the current season's theme (winter/February) displays correctly in both light and dark mode. Check that `text-primary`, `text-secondary`, `text-accent`, `bg-background`, `text-foreground` all resolve to the correct seasonal colors.
  </action>
  <verify>
  - `pnpm build` passes without errors
  - `pnpm dev` shows correct winter theme colors (blue tones)
  - Dark mode toggle changes background/foreground correctly
  - Browser DevTools shows `data-season="winter"` on `<html>` element
  - CSS variables `--primary`, `--secondary`, `--accent`, `--background`, `--foreground` are set on `:root`
  - `tailwind.config.cjs` is removed or empty (all config in CSS)
  - `plugins/tailwind/seasonalStylesPlugin.ts` is deleted
  - Scrollbar styles render (scrollbar-track-background, scrollbar-thumb-foreground)
  - `bg-spring-light` and `bg-spring-dark` classes still work (background images)
  </verify>
  <done>Seasonal theming system fully migrated to CSS custom properties with client-side season detection. All 6 theme variants (christmas, halloween, winter, spring, summer, autumn) with light/dark modes defined in global.css. Old JS plugin removed.</done>
</task>

</tasks>

<verification>
- `pnpm build` completes successfully with zero errors
- Dev server starts and displays correct seasonal theme
- Dark mode toggle works
- No console warnings about deprecated Tailwind features
- `bg-background`, `text-foreground`, `text-primary`, `text-secondary`, `text-accent` render correct colors
- Scrollbar styling visible on main page
- Shadow utilities render (shadow-lg on dropdowns, shadow-3xl on header)
- Custom animations work (fade-down on hover for dropdowns)
- Background images load (spring-light, spring-dark)
</verification>

<success_criteria>
1. Tailwind CSS 4 installed via @tailwindcss/vite plugin (TW-01)
2. All utility classes migrated to v4 syntax (TW-02)
3. All 6 seasonal themes work with light/dark variants (TW-03)
4. Dark mode functions correctly (TW-04)
5. tailwind-merge v3+ and tailwind-scrollbar v4 installed and working (TW-05)
</success_criteria>

<output>
After completion, create `.planning/phases/04-styling-linting-modernization/04-01-SUMMARY.md`
</output>
