---
phase: 04-styling-linting-modernization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .eslintrc.cjs
  - eslint.config.js
  - package.json
  - pnpm-lock.yaml
autonomous: true

must_haves:
  truths:
    - "ESLint runs successfully with flat config on all project files"
    - "TypeScript files (.ts, .tsx) are linted with @typescript-eslint rules"
    - "Astro files (.astro) are linted with eslint-plugin-astro recommended rules"
    - "JSX accessibility rules apply to React/Astro components"
    - "No legacy .eslintrc.cjs config file remains"
  artifacts:
    - path: "eslint.config.js"
      provides: "ESLint 10 flat config with TypeScript, Astro, import, jsx-a11y, n, promise plugins"
      contains: "export default"
    - path: "package.json"
      provides: "ESLint 10 and all flat-config-compatible plugin versions"
  key_links:
    - from: "eslint.config.js"
      to: "@typescript-eslint/parser"
      via: "languageOptions.parser"
      pattern: "parser.*tsParser|@typescript-eslint/parser"
    - from: "eslint.config.js"
      to: "eslint-plugin-astro"
      via: "configs.recommended spread"
      pattern: "eslintPluginAstro|eslint-plugin-astro"
    - from: "package.json"
      to: "eslint.config.js"
      via: "lint script"
      pattern: "eslint"
---

<objective>
Migrate from ESLint 8 with legacy .eslintrc.cjs to ESLint 10 with mandatory flat config (eslint.config.js), updating all plugins to flat-config-compatible versions.

Purpose: ESLint 10 removes legacy eslintrc support entirely. This migration ensures linting continues to work for all file types (.ts, .tsx, .astro) with the new flat config format.

Output: Working ESLint 10 flat config that lints all project file types correctly.
</objective>

<execution_context>
@/Users/mini/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mini/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-styling-linting-modernization/04-RESEARCH.md

@.eslintrc.cjs
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade ESLint and plugins, convert to flat config</name>
  <files>.eslintrc.cjs, eslint.config.js, package.json, pnpm-lock.yaml</files>
  <action>
  1. First, try the automated migration tool as a starting point:
     ```bash
     npx @eslint/migrate-config .eslintrc.cjs
     ```
     This generates an initial `eslint.config.mjs` from the existing config. Review output but do NOT blindly trust it -- the current `.eslintrc.cjs` is simple (extends astro recommended + jsx-a11y, uses @typescript-eslint/parser, has astro override), so manual creation may be cleaner.

  2. Upgrade ESLint and all plugins to flat-config-compatible versions:
     ```bash
     pnpm add -D eslint@latest @typescript-eslint/parser@latest @typescript-eslint/eslint-plugin@latest eslint-plugin-astro@latest astro-eslint-parser@latest eslint-plugin-import@latest eslint-plugin-jsx-a11y@latest eslint-plugin-n@latest eslint-plugin-promise@latest
     ```
     Remove `eslint-config-standard` (not needed with flat config, rules applied directly).

  3. Create `eslint.config.js` (NOT .mjs -- use .js since package.json has "type": "module") with flat config structure. The config must:

     a. Global ignores block:
     ```javascript
     {
       ignores: ['**/node_modules/**', '**/dist/**', '**/.astro/**', '**/coverage/**']
     }
     ```

     b. TypeScript/JavaScript files block:
     ```javascript
     {
       files: ['**/*.{js,mjs,cjs,ts,tsx}'],
       languageOptions: {
         parser: tsParser,
         parserOptions: {
           ecmaVersion: 'latest',
           sourceType: 'module',
         },
       },
       plugins: {
         '@typescript-eslint': tsPlugin,
         'import': importPlugin,
         'n': nPlugin,
         'promise': promisePlugin,
       },
       rules: {
         ...tsPlugin.configs.recommended.rules,
         '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
       },
     }
     ```

     NOTE: Do NOT set `parserOptions.project: './tsconfig.json'` unless type-aware rules are needed. It slows linting significantly and may cause issues with config/script files outside tsconfig scope. The current .eslintrc.cjs sets `tsconfigRootDir` but does not use type-aware rules, so this can be omitted.

     c. Astro files -- use eslint-plugin-astro's flat config exports:
     ```javascript
     ...eslintPluginAstro.configs.recommended,
     ...eslintPluginAstro.configs['jsx-a11y-recommended'],
     ```

     d. JSX accessibility for React TSX files:
     ```javascript
     {
       files: ['**/*.{jsx,tsx}'],
       plugins: {
         'jsx-a11y': jsxA11yPlugin,
       },
       rules: {
         ...jsxA11yPlugin.configs.recommended.rules,
       },
     }
     ```

     e. Dotfiles handling: ESLint 10 flat config lints dotfiles by default. Add explicit ignore if dotfiles should NOT be linted:
     ```javascript
     // Only if we want to ignore dotfiles:
     // { ignores: ['**/.*'] }
     ```
     Per the codebase, dotfiles like `.editorconfig` should not be linted. Config files like `prettier.config.cjs` are not dotfiles. The project has no `.prettierrc.js` or similar JS dotfiles that need linting. Add `'**/.*'` to the global ignores to maintain current behavior.

  4. Delete the old `.eslintrc.cjs` file.

  5. Update the `lint` script in `package.json`. Current:
     ```
     "lint": "prettier --write  \"**/*.{js,jsx,ts,tsx,md,mdx,astro}\" && eslint --fix \"src/**/*.{js,ts,jsx,tsx,astro}\""
     ```
     The eslint part should work as-is with flat config. No changes needed to the lint script unless the config file name differs.

  6. Run `pnpm lint` (or `npx eslint src/`) to verify ESLint works with the new flat config. Fix any plugin loading errors or rule conflicts.

  7. If there are linting errors in existing code, fix them or suppress with rule overrides. The goal is ESLint runs successfully, not zero warnings. Current codebase likely has some existing issues that are acceptable.
  </action>
  <verify>
  - `npx eslint src/` runs without crash or config errors
  - `npx eslint src/components/Header.astro` lints an Astro file successfully
  - `npx eslint src/lib/utils.ts` lints a TypeScript file successfully
  - `npx eslint src/components/ui/button.tsx 2>/dev/null || true` lints a TSX file (if exists)
  - `.eslintrc.cjs` is deleted
  - `eslint.config.js` exists and exports a flat config array
  - `package.json` shows eslint at v10.x+, @typescript-eslint/parser at v8.x+, eslint-plugin-astro at v1.x+
  - `npx eslint --version` shows v10.x
  </verify>
  <done>ESLint 10 with flat config running successfully on all file types (.ts, .tsx, .astro). All plugins at compatible versions. Legacy .eslintrc.cjs removed.</done>
</task>

</tasks>

<verification>
- `npx eslint src/` completes without configuration errors
- TypeScript files are linted with @typescript-eslint rules
- Astro files are linted with astro plugin recommended rules
- JSX accessibility rules are active for React components
- No reference to .eslintrc.cjs in any config or script
- `pnpm lint` script works end-to-end (prettier + eslint)
</verification>

<success_criteria>
1. ESLint 10 installed with mandatory flat config eslint.config.js (LINT-01)
2. All plugins updated to flat-config-compatible versions: @typescript-eslint v8, eslint-plugin-astro v1, import, jsx-a11y, n, promise (LINT-02)
3. All file types linted correctly: .ts, .tsx, .astro, and dotfiles explicitly handled (LINT-03)
</success_criteria>

<output>
After completion, create `.planning/phases/04-styling-linting-modernization/04-02-SUMMARY.md`
</output>
